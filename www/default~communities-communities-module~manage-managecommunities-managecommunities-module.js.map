{"version":3,"sources":["./src/app/pages/manage/communities/communities.page.html","./src/app/pages/manage/communities/communities.module.ts","./src/app/pages/manage/communities/communities.page.scss","./src/app/pages/manage/communities/communities.page.ts"],"names":[],"mappings":"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","file":"default~communities-communities-module~manage-managecommunities-managecommunities-module.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar *ngIf=\\\"modalPage\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-button (click)=\\\"closeModal()\\\"><ion-icon name=\\\"chevron-back-outline\\\"></ion-icon></ion-button>\\n    </ion-buttons>\\n    <ion-title>Manage Platforms</ion-title>\\n  </ion-toolbar>\\n  <ion-toolbar>\\n    <ion-searchbar [(ngModel)]=\\\"searchKeyword\\\" debounce=\\\"500\\\" (ionChange)=\\\"executeSearch($event)\\\"></ion-searchbar>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <ion-list>\\n    <ion-item *ngFor=\\\"let community of communities\\\" (click)=\\\"showCommunityProfile(community)\\\">\\n      <ion-thumbnail slot=\\\"start\\\">\\n        <img *ngIf=\\\"community.background\\\" [src]=\\\"community.background\\\"/>\\n        <img *ngIf=\\\"!community.background\\\" src=\\\"assets/img/group-default.png\\\"/>\\n      </ion-thumbnail>\\n      <ion-label>\\n        <h2 class=\\\"ion-text-wrap\\\">{{community.name}}\\n          <!--<ion-badge color=\\\"danger\\\" *ngIf=\\\"community.admin\\\">Admin</ion-badge>-->\\n          <ion-badge color=\\\"warning\\\" *ngIf=\\\"!community.verified\\\">Pending Approval</ion-badge>\\n          <ion-badge color=\\\"tertiary\\\" *ngIf=\\\"community.system_verified\\\">Approved</ion-badge>\\n        </h2>\\n        <p>{{community.industry.value}}</p>\\n        <p class=\\\"personnel ion-text-wrap\\\">Admin<span *ngIf=\\\"community.admins?.length > 1\\\">s</span>: <span *ngFor=\\\"let admin of community.admins; index as i\\\"><span *ngIf=\\\"i > 0\\\">, </span>{{admin.name}}</span></p>\\n        <p><ion-icon name=\\\"pin\\\"></ion-icon>{{\\\" \\\"}}{{community.meeting_location.city}}<span [hidden]=\\\"(community.meeting_location.city.length==0)||(community.meeting_location.state.length==0)\\\">{{\\\", \\\"}}</span>{{community.meeting_location.state}}<span [hidden]=\\\"(community.meeting_location.city.length==0)&&(community.meeting_location.state.length==0)\\\">{{\\\" \\\"}}</span>{{community.meeting_location.country}}</p>\\n      </ion-label>\\n      <ion-badge slot=\\\"end\\\">{{community.members.length}}</ion-badge>\\n    </ion-item>\\n    <ion-item-divider class=\\\"ion-text-wrap\\\">\\n      Displaying {{communities.length}}&nbsp;<span *ngIf=\\\"communities.length <= 1\\\"> community</span><span *ngIf=\\\"communities.length > 1\\\"> communities</span>\\n    </ion-item-divider>\\n  </ion-list>\\n  <ion-infinite-scroll position=\\\"bottom\\\" (ionInfinite)=\\\"manageMoreCommunities($event)\\\">\\n    <ion-infinite-scroll-content></ion-infinite-scroll-content>\\n  </ion-infinite-scroll>\\n  <ion-grid style=\\\"height: 100%\\\" *ngIf=\\\"ionSpinner\\\">\\n    <ion-row class=\\\"ion-justify-content-start ion-align-items-center\\\" style=\\\"height: 100%\\\">\\n      <ion-spinner name=\\\"dots\\\"></ion-spinner>\\n    </ion-row>\\n  </ion-grid>\\n</ion-content>\\n\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { CommunitiesPage } from './communities.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: CommunitiesPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [CommunitiesPage]\n})\nexport class CommunitiesPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL21hbmFnZS9jb21tdW5pdGllcy9jb21tdW5pdGllcy5wYWdlLnNjc3MifQ== */\"","import {Component, Input, ViewChild, ViewEncapsulation} from '@angular/core';\nimport {EditcommunityPage} from \"../../community/editcommunity/editcommunity.page\";\nimport {ShowcommunityPage} from \"../../community/showcommunity/showcommunity.page\";\nimport {\n    ActionSheetController,\n    AlertController, IonInfiniteScroll,\n    ModalController,\n    Platform,\n    PopoverController\n} from \"@ionic/angular\";\nimport {UserData} from \"../../../services/user.service\";\nimport {Resource} from \"../../../services/resource.service\";\nimport {Storage} from \"@ionic/storage\";\nimport {Auth} from \"../../../services/auth.service\";\nimport {Chat} from \"../../../services/chat.service\";\nimport {Churches} from \"../../../services/church.service\";\n\n@Component({\n  selector: 'app-communities',\n  templateUrl: './communities.page.html',\n  styleUrls: ['./communities.page.scss'],\n    encapsulation: ViewEncapsulation.None\n})\nexport class CommunitiesPage {\n    @ViewChild(IonInfiniteScroll, {static: false}) infiniteScroll: IonInfiniteScroll;\n    @Input() modalPage: any;\n\n    subscriptions: any = {};\n    communities = [];\n    ionSpinner = false;\n    community: any;\n    pageNum: number = 0;\n    reachedEnd: boolean = false;\n    conversation: any;\n    members: any = [];\n    searchKeyword = '';\n    refreshNeeded = false;\n\n    constructor(\n                private storage: Storage,\n                private platform: Platform,\n                private authService: Auth,\n                private chatService: Chat,\n                public userData: UserData,\n                private churchService: Churches,\n                private resourceService: Resource,\n                private modalCtrl: ModalController,\n                private alertCtrl: AlertController,) { }\n\n    ionViewWillEnter() {\n        if (this.userData && this.userData.currentCommunityAdminStatus) {\n            this.setupManageCommunities();\n        }\n\n        // link refresh user status observable with refresh handler\n        this.subscriptions['refreshUserStatus'] = this.userData.refreshUserStatus$.subscribe(this.refreshHandler);\n    }\n\n    refreshHandler = (data) => {\n        if (data.type === 'update admin' || data.type === 'change aux data'){\n            this.setupManageCommunities();\n        }\n    };\n\n    //-----------------------------------\n    // methods to search for communities\n    //-----------------------------------\n\n    async setupManageCommunities() {\n        setTimeout(async () => {\n            this.infiniteScroll.disabled = false;\n            this.reachedEnd = false;\n            this.communities = [];\n            this.pageNum = 0;\n            this.manageMoreCommunities({target: this.infiniteScroll});\n        }, 500);\n    }\n\n    async manageMoreCommunities(event){\n        this.pageNum++;\n        if (!this.reachedEnd){\n            const communities: any = await this.userData.loadMyAdminChurches(this.searchKeyword.toLowerCase(), this.pageNum);\n            this.ionSpinner = false;\n            if (!communities.length){\n                this.reachedEnd = true;\n                event.target.disabled = true;\n            } else {\n                communities.forEach((community) => {\n                    const adminIds = community.admins.map((c) => c._id);\n                    if (adminIds.indexOf(this.userData.user._id) < 0){\n                        if (community.verified) {\n                            community.system_verified = true;\n                        }\n                    } else {\n                        community.admin = true;\n                    }\n                    this.communities.push(community);\n                });\n            }\n            event.target.complete();\n        }\n        else{\n            this.ionSpinner = false;\n            event.target.complete();\n        }\n    }\n\n    async showCommunityProfile(community) {\n        const showCommunity = await this.modalCtrl.create({component: ShowcommunityPage,\n            componentProps: {community: community, modalPage: true}} );\n        await showCommunity.present();\n        const {data: refreshNeeded} = await showCommunity.onDidDismiss();\n        if (refreshNeeded) {\n            this.setupManageCommunities();\n        }\n    }\n\n    async createNewCommunity() {\n        let industries = [];\n        this.resourceService.load('en-US', \"Industry\").subscribe(async (fields: any) => {\n            for(let i = 0; i < fields.length; i++){\n                console.log(\"id\", fields[i]._id);\n                industries.push({_id: fields[i]._id, name: fields[i][\"en-US\"].value[0], selected: false});\n            }\n            const editCommunity = await this.modalCtrl.create({component: EditcommunityPage, componentProps: {industries: industries}} );\n            await editCommunity.present();\n            const {data: refreshNeeded} = await editCommunity.onDidDismiss();\n            if (refreshNeeded) {\n                this.setupManageCommunities();\n            }\n        }, async (err)=>{\n            const networkAlert = await this.alertCtrl.create({\n                header: 'No Internet Connection',\n                message: 'Please check your internet connection.',\n                buttons: ['Dismiss'],\n                cssClass: 'level-15'\n            });\n            await networkAlert.present();\n        });\n    }\n\n    executeSearch(event){\n        event.stopPropagation();\n        this.ionSpinner = true;\n        this.setupManageCommunities();\n    }\n\n    closeModal(){\n        this.modalCtrl.dismiss(this.refreshNeeded);\n    }\n\n    ionViewWillLeave() {\n        this.subscriptions['refreshUserStatus'].unsubscribe(this.refreshHandler);\n    }\n}\n"],"sourceRoot":"webpack:///"}