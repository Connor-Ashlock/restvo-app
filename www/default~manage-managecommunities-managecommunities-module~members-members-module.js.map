{"version":3,"sources":["./src/app/pages/manage/members/members.page.html","./src/app/pages/manage/members/members.module.ts","./src/app/pages/manage/members/members.page.scss","./src/app/pages/manage/members/members.page.ts"],"names":[],"mappings":"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","file":"default~manage-managecommunities-managecommunities-module~members-members-module.js","sourcesContent":["export default \"<ion-header>\\n  <ion-toolbar *ngIf=\\\"modalPage\\\">\\n    <ion-buttons slot=\\\"start\\\">\\n      <ion-button (click)=\\\"closeModal()\\\"><ion-icon name=\\\"chevron-back-outline\\\"></ion-icon></ion-button>\\n    </ion-buttons>\\n    <ion-title>{{userData.user.churches[userData.currentCommunityIndex].name}}: Members</ion-title>\\n    <ion-buttons slot=\\\"end\\\">\\n      <ion-button *ngIf=\\\"userData && userData.user\\\" (click)=\\\"presentPopover($event)\\\">\\n        <ion-icon ios=\\\"ellipsis-horizontal\\\" md=\\\"ellipsis-vertical\\\"></ion-icon>\\n      </ion-button>\\n    </ion-buttons>\\n  </ion-toolbar>\\n  <ion-toolbar>\\n    <ion-searchbar [(ngModel)]=\\\"searchKeyword\\\" debounce=\\\"500\\\" (ionChange)=\\\"executeSearch($event)\\\"></ion-searchbar>\\n  </ion-toolbar>\\n</ion-header>\\n\\n<ion-content>\\n  <ion-list>\\n    <ion-item *ngFor=\\\"let member of members\\\" (click)=\\\"editMember($event, member)\\\">\\n      <ion-avatar slot=\\\"start\\\">\\n        <img *ngIf=\\\"member.avatar\\\" [src]=\\\"member.avatar\\\" onerror=\\\"this.src='assets/img/avatar-default.jpg'\\\"/>\\n        <img *ngIf=\\\"!member.avatar\\\" src=\\\"assets/img/avatar-default.jpg\\\"/>\\n      </ion-avatar>\\n      <ion-label>{{member.name}}</ion-label>\\n      <ion-icon *ngIf=\\\"member.reportStatus?.length\\\" name=\\\"alert-circle\\\"></ion-icon>\\n      <ion-badge slot=\\\"end\\\" color={{member.color}}>{{member.role}}</ion-badge>\\n    </ion-item>\\n    <ion-item-divider class=\\\"ion-text-wrap\\\">\\n      Displaying {{members.length}} member<span *ngIf=\\\"members.length > 1\\\">s</span>\\n    </ion-item-divider>\\n  </ion-list>\\n  <ion-infinite-scroll position=\\\"bottom\\\" (ionInfinite)=\\\"manageMorePeople($event)\\\">\\n    <ion-infinite-scroll-content></ion-infinite-scroll-content>\\n  </ion-infinite-scroll>\\n  <ion-grid style=\\\"height: 100%\\\" *ngIf=\\\"ionSpinner\\\">\\n    <ion-row class=\\\"ion-justify-content-start ion-align-items-center\\\" style=\\\"height: 100%\\\">\\n      <ion-spinner name=\\\"dots\\\"></ion-spinner>\\n    </ion-row>\\n  </ion-grid>\\n</ion-content>\\n\"","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MembersPage } from './members.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MembersPage\n  }\n];\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    RouterModule.forChild(routes)\n  ],\n  declarations: [MembersPage]\n})\nexport class MembersPageModule {}\n","export default \"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJzcmMvYXBwL3BhZ2VzL21hbmFnZS9tZW1iZXJzL21lbWJlcnMucGFnZS5zY3NzIn0= */\"","import {Component, Input, OnDestroy, OnInit, ViewChild, ViewEncapsulation} from '@angular/core';\nimport {ShowrecipientinfoPage} from \"../../connect/showrecipientinfo/showrecipientinfo.page\";\nimport {\n    IonInfiniteScroll,\n    ModalController,\n    Platform,\n} from \"@ionic/angular\";\nimport {UserData} from \"../../../services/user.service\";\nimport {Resource} from \"../../../services/resource.service\";\nimport {Storage} from \"@ionic/storage\";\nimport {Auth} from \"../../../services/auth.service\";\nimport {Chat} from \"../../../services/chat.service\";\nimport {Churches} from \"../../../services/church.service\";\n\n@Component({\n  selector: 'app-members',\n  templateUrl: './members.page.html',\n  styleUrls: ['./members.page.scss'],\n    encapsulation: ViewEncapsulation.None\n})\nexport class MembersPage implements OnInit, OnDestroy {\n    @ViewChild(IonInfiniteScroll, {static: false}) infiniteScroll: IonInfiniteScroll;\n    @Input() modalPage: any;\n\n    subscriptions: any = {};\n    //variables to search people\n    ionSpinner = false;\n    community: any;\n    pageNum: number = 0;\n    reachedEnd: boolean = false;\n    conversation: any;\n    members: any = [];\n    searchKeyword = '';\n    refreshNeeded = false;\n\n  constructor(\n              private storage: Storage,\n              private platform: Platform,\n              private authService: Auth,\n              private chatService: Chat,\n              public userData: UserData,\n              private churchService: Churches,\n              private resourceService: Resource,\n              private modalCtrl: ModalController) { }\n\n    ngOnInit() {\n        if (this.userData && this.userData.currentCommunityAdminStatus) {\n            this.setupManagePeople();\n        }\n        // link refreshUserStatus Observable with refresh handler.\n        this.subscriptions['refreshUserStatus'] = this.userData.refreshUserStatus$.subscribe(this.refreshHandler);\n    }\n\n    refreshHandler = (data) => {\n        // because on first subscription, data is null. this will refresh only under special data.type\n        if (data && (data.type === 'load community ready' || data.type === 'update admin' || data.type === 'change aux data' || data.type === 'update member')) {\n            this.setupManagePeople();\n        }\n    };\n    //-----------------------------------\n    // methods to search for people\n    //-----------------------------------\n\n    async setupManagePeople(){\n        setTimeout(async () => {\n            [this.community] = await this.churchService.loadChurchProfile(this.userData.user.churches[this.userData.currentCommunityIndex]._id);\n            this.infiniteScroll.disabled = false;\n            this.reachedEnd = false;\n            this.members = [];\n            this.pageNum = 0;\n            this.manageMorePeople({target: this.infiniteScroll});\n        }, 100);\n    }\n\n    async manageMorePeople(event){\n        this.pageNum++;\n        const adminIds = this.community.admins.map((c) => {return c._id;});\n        if (!this.reachedEnd){\n            const members: any = await this.churchService.loadListOfChurchMembersProfiles(this.userData.user.churches[this.userData.currentCommunityIndex]._id, this.searchKeyword.toLowerCase(), this.pageNum);\n            this.ionSpinner = false;\n            if (!members.length){\n                this.reachedEnd = true;\n                event.target.disabled = true;\n            } else {\n                members.forEach((member)=>{\n                    if (member.wee_user){\n                        if (adminIds.indexOf(member.userId) > -1){\n                            member.role = \"Admin\";\n                            member.color = \"danger\";\n                        } else {\n                            member.role = \"Member\";\n                            member.color = \"primary\";\n                        }\n                    } else {\n                        member.role = \"Database\";\n                        member.color = \"warning\";\n                    }\n                    this.members.push(member);\n                });\n            }\n            event.target.complete();\n        }\n        else{\n            this.ionSpinner = false;\n            event.target.complete();\n        }\n    }\n\n    async editMember(event, member) {\n        event.stopPropagation();\n        member._id = member.userId;\n        const recipientModal = await this.modalCtrl.create({component: ShowrecipientinfoPage, componentProps: {recipient: member, modalPage: true}});\n        await recipientModal.present();\n        const {data: needsToRefresh} = await recipientModal.onDidDismiss();\n        if (needsToRefresh) {\n            console.log(\"refreshing...\");\n            this.setupManagePeople();\n        }\n    }\n\n    executeSearch(event){\n        event.stopPropagation();\n        this.ionSpinner = true;\n        this.setupManagePeople();\n    }\n\n    closeModal(){\n        this.modalCtrl.dismiss(this.refreshNeeded);\n    }\n\n    ngOnDestroy() {\n        this.subscriptions['refreshUserStatus'].unsubscribe(this.refreshHandler);\n    }\n}\n"],"sourceRoot":"webpack:///"}